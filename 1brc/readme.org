#+title: Billion Row Challange

I have not tested for correctness as this is more of a personal experiment in optimization using multithreading + SIMD.

The profiler report is not representative of actual throughput due to profiling overhead.

Throughput of =1brc_multicore.c= after clearing filesystem cache:

#+begin_example
Threads: 12
File size: 13156.26 MB
Time: 5.044 seconds
Throughput: 2.55 GB/s
#+end_example

* Naive (single threaded, scalar) solution

- Majority of time (49.2%) spent extracting city name and temperature from line.

#+begin_example
PROFILER REPORT
===============
total_s: 254.4257 s
Data: 12.8479 GB
throughtput: 0.0505 GB/s

       entry_point_naive: 254425712.1397us (100.0%)	71489751.5481us ( 28.1%)
              line parse: 125283842.1162us ( 49.2%)	64273168.1634us ( 25.3%)
                     cut: 61010673.9527us ( 24.0%)	61010673.9527us ( 24.0%)
       parse_temperature: 21863746.2465us (  8.6%)	21863746.2465us (  8.6%)
                  upsert: 35778943.4726us ( 14.1%)	35778896.6169us ( 14.1%)
#+end_example

* Single threaded, SIMD solution

- 1.6x speedup compared to scalar version

#+begin_example
PROFILER REPORT
===============
total_s: 156.3821 s
Data: 12.8479 GB
throughtput: 0.0822 GB/s

        entry_point_simd: 156382058.6188us (100.0%)      68586256.9632us ( 43.9%)
              line_parse: 36365111.8038us ( 23.3%)       36365111.8038us ( 23.3%)
       parse_temperature: 20102002.5786us ( 12.9%)       20102002.5786us ( 12.9%)
                  upsert: 31328687.2732us ( 20.0%)       31328687.2732us ( 20.0%)
#+end_example

* Multi threaded, SIMD solution

- 12.8x speedup compared to single threaded, scalar version
- 7.9x speedup compared to SIMD version

#+begin_example
PROFILER REPORT
===============
total_s: 14.8566 s
Data: 12.8479 GB
throughtput: 0.8648 GB/s

             entry_point: 14856626.2496us (100.0%)       5677432.2196us ( 38.2%)
              line_parse: 3325135.9025us ( 22.4%)        3325135.9025us ( 22.4%)
              parse_temp: 1965695.2634us ( 13.2%)        1965695.2634us ( 13.2%)
                  upsert: 3888362.8641us ( 26.2%)        3888362.8641us ( 26.2%)
#+end_example
